From c771229a978c69323869d4063228306dc41e15b4 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jakub=20Jank=C5=AF?= <jjanku@redhat.com>
Date: Mon, 30 Sep 2019 18:44:05 +0200
Subject: [PATCH 3/6] fixup! clipboard: do not release between remote grabs
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Jakub Jank≈Ø <jjanku@redhat.com>
---
 src/spice-gtk-session.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/spice-gtk-session.c b/src/spice-gtk-session.c
index 79385a4..cbfe3bf 100644
--- a/src/spice-gtk-session.c
+++ b/src/spice-gtk-session.c
@@ -782,6 +782,11 @@ static void clipboard_get(GtkClipboard *clipboard,
     g_return_if_fail(info < SPICE_N_ELEMENTS(atom2agent));
     g_return_if_fail(s->main != NULL);
 
+    if (s->clipboard_release_delay[selection]) {
+        SPICE_DEBUG("not requesting data from guest during delayed release");
+        return;
+    }
+
     ri.selection_data = selection_data;
     ri.info = info;
     ri.loop = g_main_loop_new(NULL, FALSE);
-- 
2.23.0
